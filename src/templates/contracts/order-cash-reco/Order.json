{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Order",
  "description": "E-commerce order data structure for reconciliation",
  "type": "object",
  "required": ["id", "orderNumber", "customerId", "status", "totalAmount", "currency", "createdAt"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique order identifier from e-commerce platform"
    },
    "orderNumber": {
      "type": "string",
      "description": "Human-readable order number",
      "pattern": "^[A-Z0-9-]+$"
    },
    "customerId": {
      "type": "string",
      "description": "Customer identifier"
    },
    "customerEmail": {
      "type": "string",
      "format": "email",
      "description": "Customer email address"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "authorized", "paid", "partially_paid", "fulfilled", "shipped", "delivered", "cancelled", "refunded", "partially_refunded"],
      "description": "Order status in lifecycle"
    },
    "financialStatus": {
      "type": "string",
      "enum": ["pending", "authorized", "paid", "partially_paid", "refunded", "partially_refunded", "voided"],
      "description": "Financial status of the order"
    },
    "fulfillmentStatus": {
      "type": "string",
      "enum": ["unfulfilled", "partially_fulfilled", "fulfilled", "restocked"],
      "description": "Fulfillment status of the order"
    },
    "totalAmount": {
      "type": "number",
      "description": "Total order amount in cents",
      "minimum": 0
    },
    "subtotalAmount": {
      "type": "number",
      "description": "Subtotal before tax and shipping in cents",
      "minimum": 0
    },
    "taxAmount": {
      "type": "number",
      "description": "Total tax amount in cents",
      "minimum": 0
    },
    "shippingAmount": {
      "type": "number",
      "description": "Total shipping amount in cents",
      "minimum": 0
    },
    "discountAmount": {
      "type": "number",
      "description": "Total discount amount in cents",
      "minimum": 0
    },
    "refundedAmount": {
      "type": "number",
      "description": "Total refunded amount in cents",
      "minimum": 0
    },
    "currency": {
      "type": "string",
      "description": "Currency code (ISO 4217)",
      "pattern": "^[A-Z]{3}$",
      "examples": ["USD", "EUR", "GBP", "CAD"]
    },
    "items": {
      "type": "array",
      "description": "Line items in the order",
      "items": {
        "type": "object",
        "required": ["productId", "quantity", "unitPrice", "totalPrice"],
        "properties": {
          "productId": {
            "type": "string",
            "description": "Product/SKU identifier"
          },
          "variantId": {
            "type": "string",
            "description": "Product variant identifier"
          },
          "productName": {
            "type": "string",
            "description": "Product display name"
          },
          "sku": {
            "type": "string",
            "description": "Stock keeping unit"
          },
          "quantity": {
            "type": "integer",
            "minimum": 1,
            "description": "Quantity ordered"
          },
          "unitPrice": {
            "type": "number",
            "minimum": 0,
            "description": "Price per unit in cents"
          },
          "totalPrice": {
            "type": "number",
            "minimum": 0,
            "description": "Total price for this line item in cents"
          },
          "taxAmount": {
            "type": "number",
            "minimum": 0,
            "description": "Tax for this line item in cents"
          },
          "discountAmount": {
            "type": "number",
            "minimum": 0,
            "description": "Discount for this line item in cents"
          }
        }
      }
    },
    "transactions": {
      "type": "array",
      "description": "Payment transactions associated with this order",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Transaction identifier"
          },
          "type": {
            "type": "string",
            "enum": ["sale", "authorization", "capture", "refund", "void"],
            "description": "Transaction type"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "success", "failure", "error"],
            "description": "Transaction status"
          },
          "amount": {
            "type": "number",
            "description": "Transaction amount in cents"
          },
          "gateway": {
            "type": "string",
            "description": "Payment gateway used",
            "examples": ["stripe", "paypal", "square", "shopify_payments"]
          },
          "gatewayTransactionId": {
            "type": "string",
            "description": "External transaction ID from payment gateway"
          },
          "processedAt": {
            "type": "string",
            "format": "date-time",
            "description": "When the transaction was processed"
          }
        }
      }
    },
    "shippingAddress": {
      "type": "object",
      "properties": {
        "firstName": { "type": "string" },
        "lastName": { "type": "string" },
        "company": { "type": "string" },
        "address1": { "type": "string" },
        "address2": { "type": "string" },
        "city": { "type": "string" },
        "province": { "type": "string" },
        "provinceCode": { "type": "string" },
        "country": { "type": "string" },
        "countryCode": { "type": "string", "pattern": "^[A-Z]{2}$" },
        "zip": { "type": "string" },
        "phone": { "type": "string" }
      }
    },
    "billingAddress": {
      "type": "object",
      "properties": {
        "firstName": { "type": "string" },
        "lastName": { "type": "string" },
        "company": { "type": "string" },
        "address1": { "type": "string" },
        "address2": { "type": "string" },
        "city": { "type": "string" },
        "province": { "type": "string" },
        "provinceCode": { "type": "string" },
        "country": { "type": "string" },
        "countryCode": { "type": "string", "pattern": "^[A-Z]{2}$" },
        "zip": { "type": "string" },
        "phone": { "type": "string" }
      }
    },
    "tags": {
      "type": "array",
      "description": "Tags for categorization",
      "items": {
        "type": "string"
      }
    },
    "source": {
      "type": "string",
      "description": "Order source",
      "examples": ["web", "pos", "mobile_app", "marketplace", "manual"]
    },
    "channel": {
      "type": "string",
      "description": "Sales channel",
      "examples": ["online_store", "amazon", "facebook", "instagram", "pos"]
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "Order creation timestamp"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp"
    },
    "cancelledAt": {
      "type": "string",
      "format": "date-time",
      "description": "Cancellation timestamp"
    },
    "closedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Order closure timestamp"
    },
    "metadata": {
      "type": "object",
      "description": "Additional platform-specific data",
      "additionalProperties": true
    }
  }
}